import{_ as O,r as f,A as C,k as j,v as F,o as n,c as i,f as e,N as _,F as E,K as h,l as k,V as z,m as P}from"./index-ff30b7a2.js";import{M as L}from"./modalAcceptAution-e2cd8f25.js";import"./pspdfkit-fbb14319.js";import{_ as S}from"./image-0fc6b0a0.js";const U={props:{form:{type:Object},acceptAution:{type:Function},index:{type:Function}},setup(p){const d=f(p.form);f(null);const u=f(!1),t=L(),D=f(C(()=>"https://s3.us-east-2.amazonaws.com/files.autosensei.ca/")),v=f(""),b=f(null),g=async c=>{console.log("recivied",c),u.value=!0;try{const a=new Blob([c],{type:"application/pdf"},{name:Date.now()+"."+c.extension}),r=new FormData;r.append("file",a),r.append("location","test/pdf");let o=await z({url:"/uploader/create",method:"POST",headers:{"content-type":"multipart/form-data"},data:r});if(o.data){let x=await p.acceptAution(o.data);console.log("res",x),x&&(v.value="https://apidev.autosensei.ca/files/"+o.data,s.value.step1=!1,s.value.step2=!1,s.value.step3=!0)}console.log(o)}catch(a){u.value=!1,console.error("error",a)}finally{u.value=!1}},s=f({step1:!0,step2:!1,step3:!1}),y=()=>{const c=HTMLAnchorElement.prototype.hasOwnProperty("download"),a=new Blob([b.value],{type:"application/pdf"});if(g(a),navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(a,"download.pdf");else if(c){const l=window.URL.createObjectURL(a);r(l),window.URL.revokeObjectURL(l)}else{const l=new FileReader;l.onloadend=function(){const o=l.result;r(o)},l.readAsDataURL(a)}function r(l){const o=document.createElement("a");o.href=l,o.style.display="none",o.download="download.pdf",o.setAttribute("download","download.pdf"),document.body.appendChild(o),o.click(),document.body.removeChild(o),w()}},A=async c=>{console.log("statusModal.dataAutiont",t.dataAutiont),c==1&&(s.value.step1=!1,s.value.step2=!0,u.value=!0,s.value.step2&&(t.dataAutiont.contract?await p.acceptAution(t.dataAutiont.contract)&&(v.value="https://apidev.autosensei.ca/files/"+t.dataAutiont.contract,s.value.step1=!1,s.value.step2=!1,s.value.step3=!0,u.value=!1):z.get(`/auction/contract/${t.dataAutiont._id}`).then(async a=>{console.log("resPDF",a),await p.acceptAution(a.data.contract)&&(v.value="https://apidev.autosensei.ca/files/"+a.data.contract,s.value.step1=!1,s.value.step2=!1,s.value.step3=!0,u.value=!1)})))},w=()=>{t.closeModal(!1),s.value.step2&&p.index()};return{formData:d,statusModal:t,bucket:D,steps:s,next:A,close:w,loading:u,showPdf:v,pdfDonwload:y}}},V={class:"fixed inset-0 flex items-end md:items-center z-50 md:justify-center bg-base-black bg-opacity-50"},N={class:"max-w-xl w-full overflow-hidden bg-white rounded-lg shadow-xl animation-fade-modal"},R={class:"p-2 md:p-4 rounded-t-lg bg-[#22282F] flex items-center justify-between"},T={key:0,class:"text-sm md:text-xl text-white"},H={key:1,class:"text-sm md:text-xl text-white"},I={key:2,class:"text-sm md:text-xl text-white"},K=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1),Y=[K],q={key:0,class:"w-full h-[30vh]"},G=P('<div class="w-full h-full flex justify-center items-center"><div class="absolute top-1/2 left-1/2 -mt-4 -ml-2 h-8 w-4 text-indigo-700"><div class="absolute -left-[30px] z-10 h-[80px] w-[80px]"><div class="animate-bounce"><svg xmlns="http://www.w3.org/2000/svg" class="animate-spin" fill="#c1f861" stroke="#fff" stroke-width="0" viewBox="0 0 16 16"><path d="M8 0c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8-3.582-8-8-8zM8 4c2.209 0 4 1.791 4 4s-1.791 4-4 4-4-1.791-4-4 1.791-4 4-4zM12.773 12.773c-1.275 1.275-2.97 1.977-4.773 1.977s-3.498-0.702-4.773-1.977-1.977-2.97-1.977-4.773c0-1.803 0.702-3.498 1.977-4.773l1.061 1.061c0 0 0 0 0 0-2.047 2.047-2.047 5.378 0 7.425 0.992 0.992 2.31 1.538 3.712 1.538s2.721-0.546 3.712-1.538c2.047-2.047 2.047-5.378 0-7.425l1.061-1.061c1.275 1.275 1.977 2.97 1.977 4.773s-0.702 3.498-1.977 4.773z"></path></svg></div><p class="text-base-gray font-medium pl-2">Loading...</p></div></div></div>',1),J=[G],Q={key:0,class:"p-2 md:p-4 flex md:gap-3 flex-col"},W={class:"flex justify-start items-center gap-2"},X={class:"flex gap-3 items-start"},Z={class:"w-[80px] md:w-[120px] md:h-[90px]"},$=["src"],tt={key:1,class:"shadow-xl w-full h-full rounded-lg object-cover",src:S,alt:""},et={class:"flex justify-between flex-col h-full"},st={class:"font-semibold capitalize md:text-base text-sm"},ot=e("p",{class:"capitalize text-sm md:text-base"},"Final Bid",-1),at={class:"font-medium text-sm text-base-black md:text-2xl"},lt={class:"text-[#666666] mt-1 text-xs md:text-base"},nt={class:"mt-2 border-[#E0E0E0] border-t-[1px]"},it={class:"pt-4"},dt={class:"text-xs md:text-base"},ct={class:"flex pt-4 gap-2 items-center justify-between"},rt=e("div",{id:"pspdfkit",style:{width:"100%",height:"70vh"}},null,-1),ut=[rt],ft={key:1,class:"p-4 flex justify-center items-center flex-col gap-3"},pt=e("p",{class:"font-semibold capitalize md:text-xl"},"Final Bid Approved!",-1),mt=e("p",{class:"capitalize text-xs md:text-base"},"Download the Actual Sheet Below and Hand It to the Buyer During the Vehicle Drop-Off Process.",-1),ht={class:"w-full"},vt=["src"];function wt(p,d,u,t,D,v){var b,g,s,y,A,w,c,a,r,l,o,x,M,B;return j((n(),i("div",V,[e("div",N,[e("div",R,[t.steps.step1?(n(),i("p",T,"Accept Auction")):_("",!0),t.steps.step2?(n(),i("p",H,"Contract Auction")):_("",!0),t.steps.step3?(n(),i("p",I,"Download Contract")):_("",!0),(n(),i("svg",{onClick:d[0]||(d[0]=(...m)=>t.close&&t.close(...m)),xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-8 md:w-8 md:h-8 cursor-pointer",fill:"none",viewBox:"0 0 24 24",stroke:"#fff"},Y))]),t.loading?(n(),i("div",q,J)):(n(),i(E,{key:1},[t.steps.step1?(n(),i("div",Q,[e("div",W,[e("div",X,[e("div",Z,[(b=t.statusModal.dataAutiont)!=null&&b.photos?(n(),i("img",{key:0,class:"w-full h-full shadow-xl rounded-lg object-cover",src:t.bucket+((g=t.statusModal.dataAutiont)==null?void 0:g.photos[0].url),alt:""},null,8,$)):(n(),i("img",tt))]),e("div",et,[e("p",st,h((y=(s=t.statusModal.dataAutiont)==null?void 0:s.vehicleDetails)==null?void 0:y.year)+" "+h((w=(A=t.statusModal.dataAutiont)==null?void 0:A.vehicleDetails)==null?void 0:w.make)+" "+h((a=(c=t.statusModal.dataAutiont)==null?void 0:c.vehicleDetails)==null?void 0:a.model),1),ot,e("p",at,[k("$"+h((l=(r=t.statusModal.dataAutiont)==null?void 0:r.bids[0])==null?void 0:l.amount)+"/",1),e("span",lt,h((x=(o=t.statusModal.dataAutiont)==null?void 0:o.bids)==null?void 0:x.length)+" Bids",1)])])])]),e("div",nt,[e("div",it,[e("p",dt,[k("Are you sure you want to accept the final bid for the "),e("strong",null,h((B=(M=t.statusModal.dataAutiont)==null?void 0:M.vehicleDetails)==null?void 0:B.model),1),k("? ")]),e("div",ct,[e("button",{onClick:d[1]||(d[1]=(...m)=>t.close&&t.close(...m)),class:"btn w-full border border-[#E0E0E0]"},"No"),e("button",{onClick:d[2]||(d[2]=m=>t.next(1)),class:"btn w-full bg-primary rounded-md"},"Yes")])])])])):_("",!0),j(e("div",null,ut,512),[[F,t.steps.step2]]),t.steps.step3?(n(),i("div",ft,[pt,mt,e("div",ht,[e("iframe",{class:"w-full h-[60vh]",src:t.showPdf,frameborder:"0"},null,8,vt)]),e("button",{onClick:d[3]||(d[3]=(...m)=>t.pdfDonwload&&t.pdfDonwload(...m)),class:"btn w-full bg-primary rounded-md"}," Download PDF ")])):_("",!0)],64))])],512)),[[F,t.statusModal.isActive]])}const yt=O(U,[["render",wt]]);export{yt as M};
