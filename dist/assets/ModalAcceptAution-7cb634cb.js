import{_ as E,r as h,A as z,b as I,U as j,k as B,v as C,o as i,c as d,f as s,N as _,F as K,K as y,l as F,V,m as S}from"./index-07dbf06f.js";import{M as Z}from"./modalAcceptAution-2e466b02.js";import{P as x}from"./pspdfkit-60446c6b.js";const L={props:{form:{type:Object},acceptAution:{type:Function},index:{type:Function}},setup(g){const c=h(g.form);h(null);const l=h(!1),e=Z(),P=h(z(()=>"https://s3.us-east-2.amazonaws.com/files.autosensei.ca/")),p=h(""),b=h(null),k=async o=>{console.log("recivied",o),l.value=!0;try{const u=new Blob([o],{type:"application/pdf"},{name:Date.now()+"."+o.extension}),n=new FormData;n.append("file",u),n.append("location","test/pdf");let r=await j({url:"/uploader/create",method:"POST",headers:{"content-type":"multipart/form-data"},data:n});if(r.data){let f=await g.acceptAution(r.data);console.log("res",f),f&&(p.value="https://apidev.autosensei.ca/files/"+r.data,a.value.step1=!1,a.value.step2=!1,a.value.step3=!0)}console.log(r)}catch(u){l.value=!1,console.error("error",u)}finally{l.value=!1}},a=h({step1:!0,step2:!1,step3:!1}),A=()=>{const o=document.createElement("a");o.href=p.value,o.target="_blank",o.download="contect-file.pdf",document.body.appendChild(o),o.click(),document.body.removeChild(o)},D=async o=>{if(console.log("statusModal.dataAutiont",e.dataAutiont),o==1&&(a.value.step1=!1,a.value.step2=!0,l.value=!0,a.value.step2)){const u=`${window.location.protocol}//${window.location.host}/assets/`;l.value=!1,!l.value&&a.value.step2&&(console.log("showPdf.value",p.value),x.load({baseUrl:u,licenseKey:"HO2dV-bDcn32RCF6j2nDeKYNGqP1EOSnmSLLmbDrrdWJGwDq5yWsJs8pr31-EOKWXetRmJoBjUgv4AoEicoPgQw6Htu9foJBCUCWNZ2n7EvLcpMfoNLqokulJv87rHwmB9jnVIBTKGCZ7RKjGpERaDOl-JXfBFqdP6tSA07KKrsGh0k22IcAfwlevAAZNBOe72mr8i6D5tjXisarqg3a4vsSFuWyrmidugVCVPQsARlTZ5phlM3p4WSi032q6k3C7Zkt2UwLkGu6xfMy0u8wTOYLpjE8AMl5p4PC7j2I0WTVtrjYHLVyTJ-H0-bUUh1M_5pDIsK3YwHZNA5o5I0pnL70uk4nRPsvKL5hAxzI5e_PSWj8Oek73s6pf-htNu4PrL8YMfaX2KOo4tv3Q7Xsu6fhHOmkdvRn-UyCqQz8aJam2BZFpzXYndnfTToNV3v2PZ8ixUAzk03lKFvcThJg6wGTv1lo_AQ1zOx96eqaU069ZXuduPThRxd_i0zhEkGDfVKFaZWd03UaD0ZCDPWk5lSl0AuZJWFEKVyLQBLX2SDAf6z4m699tJ4jggOZoiQjD6rceOZUGAMCYAIMi4Z_6spoyIaAM4reyti70sY_K-Ccji1VNQKFlm0ne381Pyy298BJH2xQZnEPAWEtnFp1Xw==",container:"#pspdfkit",document:p.value}).then(async function(n){const m=n.toolbarItems;console.log("items",m),n.setToolbarItems(m.filter(t=>t.type!=="export-pdf"&&t.type!=="search"&&t.type!=="annotate"&&t.type!=="multi-annotations-selection"&&t.type!=="signature"&&t.type!=="debug"&&t.type!=="document-crop"&&t.type!=="document-editor"&&t.type!=="print"&&t.type!=="polyline"&&t.type!=="cloudy-polygon"&&t.type!=="polygon"&&t.type!=="ellipse"&&t.type!=="arrow"&&t.type!=="link"&&t.type!=="line"&&t.type!=="callout"&&t.type!=="note"&&t.type!=="rectangle"&&t.type!=="stamp"&&t.type!=="image"&&t.type!=="ink-eraser"&&t.type!=="text-highlighter"&&t.type!=="text"&&t.type!=="highlighter"&&t.type!=="ink"&&t.type!=="pan"&&t.type!=="pager"&&t.type!=="sidebar-layers"&&t.type!=="sidebar-thumbnails"&&t.type!=="sidebar-document-outline"&&t.type!=="sidebar-bookmarks"&&t.type!=="sidebar-signatures"&&t.type!=="sidebar-annotations")),a.value.step2=!0;const r=new x.Annotations.WidgetAnnotation({id:x.generateInstantId(),pageIndex:0,boundingBox:new x.Geometry.Rect({left:108,top:758,width:100,height:20}),formFieldName:"my signature form field"}),f=new x.FormFields.SignatureFormField({name:"my signature form field",annotationIds:new x.Immutable.List([r.id])});await n.create([r,f]),n.addEventListener("storedSignatures.create",async t=>{console.log("create",t);const w=await n.exportPDF({flatten:!0});b.value=w,k(w)}),a.value.step1=!1,a.value.step2=!0,l.value=!1}))}},M=()=>{e.closeModal(!1),a.value.step2&&g.index()};return I(()=>{l.value=!0,e.dataAutiont.contract?(p.value="https://apidev.autosensei.ca/files/"+e.dataAutiont.contract,l.value=!1):j.get(`/auction/contract/${e.dataAutiont._id}`).then(async o=>{console.log("resPDF",o),p.value="https://apidev.autosensei.ca/files/"+o.data.contract,l.value=!1})}),{formData:c,statusModal:e,bucket:P,steps:a,next:D,close:M,loading:l,showPdf:p,pdfDonwload:A}}},N={class:"fixed inset-0 flex items-end md:items-center z-50 md:justify-center bg-base-black bg-opacity-50"},O={class:"max-w-xl w-full overflow-hidden bg-white rounded-lg shadow-xl animation-fade-modal"},T={class:"p-2 md:p-4 rounded-t-lg bg-[#22282F] flex items-center justify-between"},W={key:0,class:"text-sm md:text-xl text-white"},J={key:1,class:"text-sm md:text-xl text-white"},U={key:2,class:"text-sm md:text-xl text-white"},G=s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1),H=[G],Q={key:0,class:"w-full h-[30vh]"},R=S('<div class="w-full h-full flex justify-center items-center"><div class="absolute top-1/2 left-1/2 -mt-4 -ml-2 h-8 w-4 text-indigo-700"><div class="absolute -left-[30px] z-10 h-[80px] w-[80px]"><div class="animate-bounce"><svg xmlns="http://www.w3.org/2000/svg" class="animate-spin" fill="#c1f861" stroke="#fff" stroke-width="0" viewBox="0 0 16 16"><path d="M8 0c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8-3.582-8-8-8zM8 4c2.209 0 4 1.791 4 4s-1.791 4-4 4-4-1.791-4-4 1.791-4 4-4zM12.773 12.773c-1.275 1.275-2.97 1.977-4.773 1.977s-3.498-0.702-4.773-1.977-1.977-2.97-1.977-4.773c0-1.803 0.702-3.498 1.977-4.773l1.061 1.061c0 0 0 0 0 0-2.047 2.047-2.047 5.378 0 7.425 0.992 0.992 2.31 1.538 3.712 1.538s2.721-0.546 3.712-1.538c2.047-2.047 2.047-5.378 0-7.425l1.061-1.061c1.275 1.275 1.977 2.97 1.977 4.773s-0.702 3.498-1.977 4.773z"></path></svg></div><p class="text-base-gray font-medium pl-2">Loading...</p></div></div></div>',1),X=[R],Y={key:0,class:"p-2 md:p-4 flex md:gap-3 flex-col"},q={class:"flex justify-start items-center gap-2"},$={class:"flex gap-3 items-start"},tt={class:"w-[80px] md:w-[120px] md:h-[90px]"},et=["src"],st={key:1,class:"shadow-xl w-full h-full rounded-lg object-cover",src:V,alt:""},ot={class:"flex justify-between flex-col h-full"},at={class:"font-semibold capitalize md:text-base text-sm"},lt=s("p",{class:"capitalize text-sm md:text-base"},"Final Bid",-1),nt={class:"font-medium text-sm text-base-black md:text-2xl"},it={class:"text-[#666666] mt-1 text-xs md:text-base"},dt={class:"mt-2 border-[#E0E0E0] border-t-[1px]"},ct={class:"pt-4"},rt={class:"text-xs md:text-base"},pt={class:"flex pt-4 gap-2 items-center justify-between"},ut=s("div",{id:"pspdfkit",style:{width:"100%",height:"90vh"}},null,-1),ft=[ut],ht={key:1,class:"p-4 flex justify-center items-center flex-col gap-3"},mt=s("p",{class:"font-semibold capitalize md:text-xl"},"Final Bid Approved!",-1),vt=s("p",{class:"capitalize text-xs md:text-base"},"Download the Actual Sheet Below and Hand It to the Buyer During the Vehicle Drop-Off Process.",-1),yt={class:"w-full"},xt=["src"];function wt(g,c,l,e,P,p){var b,k,a,A,D,M,o,u,n,m,r,f,t,w;return B((i(),d("div",N,[s("div",O,[s("div",T,[e.steps.step1?(i(),d("p",W,"Accept Auction")):_("",!0),e.steps.step2?(i(),d("p",J,"Contract Auction")):_("",!0),e.steps.step3?(i(),d("p",U,"Download Contract")):_("",!0),(i(),d("svg",{onClick:c[0]||(c[0]=(...v)=>e.close&&e.close(...v)),xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-8 md:w-8 md:h-8 cursor-pointer",fill:"none",viewBox:"0 0 24 24",stroke:"#fff"},H))]),e.loading?(i(),d("div",Q,X)):(i(),d(K,{key:1},[e.steps.step1?(i(),d("div",Y,[s("div",q,[s("div",$,[s("div",tt,[(b=e.statusModal.dataAutiont)!=null&&b.photos?(i(),d("img",{key:0,class:"w-full h-full shadow-xl rounded-lg object-cover",src:e.bucket+((k=e.statusModal.dataAutiont)==null?void 0:k.photos[0].url),alt:""},null,8,et)):(i(),d("img",st))]),s("div",ot,[s("p",at,y((A=(a=e.statusModal.dataAutiont)==null?void 0:a.vehicleDetails)==null?void 0:A.year)+" "+y((M=(D=e.statusModal.dataAutiont)==null?void 0:D.vehicleDetails)==null?void 0:M.make)+" "+y((u=(o=e.statusModal.dataAutiont)==null?void 0:o.vehicleDetails)==null?void 0:u.model),1),lt,s("p",nt,[F("$"+y((m=(n=e.statusModal.dataAutiont)==null?void 0:n.bids[0])==null?void 0:m.amount)+"/",1),s("span",it,y((f=(r=e.statusModal.dataAutiont)==null?void 0:r.bids)==null?void 0:f.length)+" Bids",1)])])])]),s("div",dt,[s("div",ct,[s("p",rt,[F("Are you sure you want to accept the final bid for the "),s("strong",null,y((w=(t=e.statusModal.dataAutiont)==null?void 0:t.vehicleDetails)==null?void 0:w.model),1),F("? ")]),s("div",pt,[s("button",{onClick:c[1]||(c[1]=(...v)=>e.close&&e.close(...v)),class:"btn w-full border border-[#E0E0E0]"},"No"),s("button",{onClick:c[2]||(c[2]=v=>e.next(1)),class:"btn w-full bg-primary rounded-md"},"Yes")])])])])):_("",!0),B(s("div",null,ft,512),[[C,e.steps.step2]]),e.steps.step3?(i(),d("div",ht,[mt,vt,s("div",yt,[s("iframe",{class:"w-full h-[60vh]",src:e.showPdf,frameborder:"0"},null,8,xt)]),s("button",{onClick:c[3]||(c[3]=(...v)=>e.pdfDonwload&&e.pdfDonwload(...v)),class:"btn w-full bg-primary rounded-md"}," Download PDF ")])):_("",!0)],64))])],512)),[[C,e.statusModal.isActive]])}const kt=E(L,[["render",wt]]);export{kt as M};
