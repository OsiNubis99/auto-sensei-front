<template>
    <div v-show="loading"
        class="bg-[#000000a1;] left-0 top-0 fixed w-full h-full z-[100] flex justify-center items-center">
        <div class="absolute top-1/2 left-1/2 -mt-4 -ml-2 h-8 w-4 text-indigo-700">
            <div class="absolute -left-[30px] z-10  h-[80px] w-[80px] ">
                <div class="animate-bounce">
                    <svg xmlns="http://www.w3.org/2000/svg" class="animate-spin" fill="#c1f861" stroke="#fff"
                        stroke-width="0" viewBox="0 0 16 16">
                        <path
                            d="M8 0c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8-3.582-8-8-8zM8 4c2.209 0 4 1.791 4 4s-1.791 4-4 4-4-1.791-4-4 1.791-4 4-4zM12.773 12.773c-1.275 1.275-2.97 1.977-4.773 1.977s-3.498-0.702-4.773-1.977-1.977-2.97-1.977-4.773c0-1.803 0.702-3.498 1.977-4.773l1.061 1.061c0 0 0 0 0 0-2.047 2.047-2.047 5.378 0 7.425 0.992 0.992 2.31 1.538 3.712 1.538s2.721-0.546 3.712-1.538c2.047-2.047 2.047-5.378 0-7.425l1.061-1.061c1.275 1.275 1.977 2.97 1.977 4.773s-0.702 3.498-1.977 4.773z">
                        </path>
                    </svg>
                </div>
                <p class=" text-base-gray font-medium pl-2 ">Loading...</p>
            </div>
        </div>
    </div>
    <div class="bg-white  mb-7 gap-5  shadow-steps p-5 w-full">
        <div class="flex justify-between items-center">
            <div class="flex  gap-2 md:gap-6">
                <img src="@/assets/svg/review.svg" alt="">
                <div class="flex flex-col ">
                    <p class="font-semibold text-sm md:text-xl">Payment</p>
                    <p class=" text-xs md:text-base">Input and Arrange Your Payment Details</p>
                </div>
            </div>
            <div class=" hidden md:flex ">
                <button @click="addpayment" class="btn bg-primary px-6 py-4 text-base-black">Add Credit Card</button>
            </div>
        </div>
        <div v-for="(payment, index) in storeAuth.userData.paymentMethods" :key="index"
            class="border px-4 mt-6 py-4 flex justify-between items-center rounded-lg border-[#E0E0E0]">
            <div class="flex  gap-4 items-center">
                <div>
                    <svg v-if="payment.card.brand == 'visa'" xmlns="http://www.w3.org/2000/svg" width="40" height="41"
                        viewBox="0 0 40 41" fill="none">
                        <path
                            d="M37.0367 26.7799L36.6617 24.9049H32.4717L31.805 26.7665L28.4467 26.7732C30.0455 22.9284 31.6477 19.0851 33.2533 15.2432C33.5267 14.5915 34.0117 14.2599 34.7267 14.2632C35.2733 14.2682 36.165 14.2682 37.4033 14.2649L40 26.7749L37.0367 26.7799ZM33.415 22.3365H36.115L35.1067 17.6365L33.415 22.3365ZM11.7667 14.2615L15.1433 14.2649L9.92333 26.7815L6.505 26.7782C5.64541 23.4721 4.79652 20.1632 3.95833 16.8515C3.79167 16.1915 3.46167 15.7299 2.82667 15.5115C2.26167 15.3165 1.32 15.0165 0 14.6082V14.2665H5.395C6.32833 14.2665 6.87333 14.7182 7.04833 15.6449C7.225 16.5732 7.66833 18.9365 8.38167 22.7349L11.7667 14.2615ZM19.7833 14.2649L17.1133 26.7782L13.9 26.7749L16.5667 14.2615L19.7833 14.2649ZM26.3 14.0332C27.2617 14.0332 28.4733 14.3332 29.17 14.6082L28.6067 17.2032C27.9767 16.9499 26.94 16.6082 26.0683 16.6199C24.8017 16.6415 24.0183 17.1732 24.0183 17.6832C24.0183 18.5132 25.3783 18.9315 26.7783 19.8382C28.3767 20.8715 28.5867 21.7999 28.5667 22.8082C28.545 24.9015 26.7783 26.9665 23.0517 26.9665C21.3517 26.9415 20.7383 26.7982 19.3517 26.3065L19.9383 23.5982C21.35 24.1899 21.9483 24.3782 23.155 24.3782C24.26 24.3782 25.2083 23.9315 25.2167 23.1532C25.2233 22.5999 24.8833 22.3249 23.6433 21.6415C22.4033 20.9565 20.6633 20.0082 20.6867 18.1049C20.715 15.6682 23.0233 14.0332 26.3017 14.0332H26.3Z"
                            fill="#09121F" />
                    </svg>
                    <svg v-else xmlns="http://www.w3.org/2000/svg" width="40" height="41" viewBox="0 0 40 41"
                        fill="none">
                        <path
                            d="M9.66429 32.9442V31.2849C9.66429 30.6486 9.27365 30.2339 8.60408 30.2339C8.26935 30.2339 7.90667 30.3445 7.65557 30.7041C7.46038 30.3998 7.18144 30.2339 6.76297 30.2339C6.48391 30.2339 6.2051 30.3168 5.98182 30.6211V30.2892H5.396V32.9442H5.98182V31.4784C5.98182 31.0083 6.23293 30.787 6.62357 30.787C7.01395 30.787 7.2094 31.0359 7.2094 31.4784V32.9442H7.79523V31.4784C7.79523 31.0083 8.07403 30.787 8.43671 30.787C8.82735 30.787 9.02254 31.0359 9.02254 31.4784V32.9442H9.66429ZM18.34 30.2892H17.3916V29.4872H16.8058V30.2892H16.2758V30.8146H16.8057V32.0315C16.8057 32.64 17.0568 32.9995 17.7264 32.9995C17.9775 32.9995 18.2563 32.9166 18.4517 32.806L18.2842 32.3081C18.1169 32.4187 17.9217 32.4464 17.7821 32.4464C17.5032 32.4464 17.3916 32.2805 17.3916 32.0038V30.8146H18.34V30.2892ZM23.3057 30.2338C22.971 30.2338 22.7478 30.3998 22.6083 30.6211V30.2892H22.0225V32.9442H22.6083V31.4508C22.6083 31.0083 22.8035 30.7594 23.1662 30.7594C23.2778 30.7594 23.4173 30.7871 23.5289 30.8147L23.6962 30.2616C23.5846 30.2339 23.4173 30.2339 23.3057 30.2339V30.2338ZM15.8015 30.5104C15.5224 30.3168 15.1319 30.2339 14.7135 30.2339C14.044 30.2339 13.5977 30.5658 13.5977 31.0912C13.5977 31.5338 13.9325 31.7826 14.5183 31.8656L14.7972 31.8933C15.1041 31.9485 15.2715 32.0315 15.2715 32.1699C15.2715 32.3634 15.0483 32.5017 14.6577 32.5017C14.2672 32.5017 13.9603 32.3634 13.765 32.2252L13.486 32.6676C13.7929 32.8889 14.2114 32.9995 14.6297 32.9995C15.4109 32.9995 15.8573 32.64 15.8573 32.1422C15.8573 31.672 15.4946 31.4231 14.9366 31.3402L14.6577 31.3124C14.4066 31.2847 14.2114 31.2295 14.2114 31.0636C14.2114 30.87 14.4066 30.7594 14.7135 30.7594C15.0483 30.7594 15.383 30.8976 15.5504 30.9806L15.8015 30.5104ZM31.3679 30.2339C31.0331 30.2339 30.8099 30.3998 30.6704 30.6211V30.2892H30.0846V32.9442H30.6704V31.4508C30.6704 31.0083 30.8657 30.7594 31.2283 30.7594C31.34 30.7594 31.4795 30.7871 31.5911 30.8147L31.7584 30.2616C31.6468 30.2339 31.4795 30.2339 31.3679 30.2339ZM23.8915 31.6167C23.8915 32.4187 24.4494 32.9995 25.3143 32.9995C25.7048 32.9995 25.9837 32.9166 26.2627 32.6953L25.9837 32.2252C25.7606 32.3911 25.5375 32.474 25.2863 32.474C24.8121 32.474 24.4774 32.1422 24.4774 31.6167C24.4774 31.1189 24.8121 30.787 25.2863 30.7594C25.5375 30.7594 25.7606 30.8423 25.9837 31.0083L26.2627 30.5382C25.9837 30.3168 25.7048 30.2339 25.3143 30.2339C24.4494 30.2339 23.8915 30.8147 23.8915 31.6167ZM29.3035 31.6167V30.2892H28.7177V30.6211C28.5224 30.3722 28.2434 30.2339 27.8808 30.2339C27.1276 30.2339 26.5417 30.8147 26.5417 31.6167C26.5417 32.4187 27.1276 32.9995 27.8808 32.9995C28.2713 32.9995 28.5503 32.8613 28.7177 32.6123V32.9442H29.3035V31.6167ZM27.1554 31.6167C27.1554 31.1465 27.4623 30.7594 27.9644 30.7594C28.4386 30.7594 28.7735 31.1189 28.7735 31.6167C28.7735 32.0869 28.4386 32.474 27.9644 32.474C27.4623 32.4463 27.1554 32.0869 27.1554 31.6167ZM20.1534 30.2339C19.3723 30.2339 18.8143 30.787 18.8143 31.6167C18.8143 32.4464 19.3721 32.9995 20.1812 32.9995C20.5718 32.9995 20.9624 32.8889 21.2693 32.64L20.9902 32.2252C20.7671 32.3911 20.4881 32.5017 20.2092 32.5017C19.8465 32.5017 19.4838 32.3358 19.4001 31.8655H21.3809V31.6444C21.4088 30.787 20.9067 30.2339 20.1534 30.2339ZM20.1534 30.7317C20.516 30.7317 20.7672 30.953 20.8229 31.3679H19.4281C19.4838 31.0083 19.735 30.7317 20.1534 30.7317ZM34.6876 31.6167V29.2383H34.1017V30.6211C33.9064 30.3722 33.6275 30.2339 33.2648 30.2339C32.5116 30.2339 31.9258 30.8147 31.9258 31.6167C31.9258 32.4187 32.5116 32.9995 33.2648 32.9995C33.6554 32.9995 33.9344 32.8613 34.1017 32.6123V32.9442H34.6876V31.6167ZM32.5396 31.6167C32.5396 31.1465 32.8463 30.7594 33.3485 30.7594C33.8228 30.7594 34.1575 31.1189 34.1575 31.6167C34.1575 32.0869 33.8228 32.474 33.3485 32.474C32.8463 32.4463 32.5396 32.0869 32.5396 31.6167ZM12.956 31.6167V30.2892H12.3702V30.6211C12.1748 30.3722 11.8959 30.2339 11.5332 30.2339C10.78 30.2339 10.1942 30.8147 10.1942 31.6167C10.1942 32.4187 10.78 32.9995 11.5332 32.9995C11.9239 32.9995 12.2028 32.8613 12.3702 32.6123V32.9442H12.956V31.6167ZM10.78 31.6167C10.78 31.1465 11.0869 30.7594 11.589 30.7594C12.0633 30.7594 12.3981 31.1189 12.3981 31.6167C12.3981 32.0869 12.0633 32.474 11.589 32.474C11.0869 32.4463 10.78 32.0869 10.78 31.6167Z"
                            fill="black" />
                        <path d="M15.6061 10.1289H24.3936V25.7823H15.6061V10.1289Z" fill="#FF5F00" />
                        <path
                            d="M16.1641 17.9562C16.1641 14.7758 17.6705 11.9548 19.9858 10.1295C18.2843 8.802 16.1363 8 13.793 8C8.24131 8 3.75 12.4526 3.75 17.9562C3.75 23.4597 8.24131 27.9124 13.7928 27.9124C16.1361 27.9124 18.2841 27.1104 19.9858 25.7828C17.6705 23.9852 16.1641 21.1366 16.1641 17.9562Z"
                            fill="#EB001B" />
                        <path
                            d="M36.2498 17.9562C36.2498 23.4597 31.7585 27.9124 26.207 27.9124C23.8637 27.9124 21.7157 27.1104 20.014 25.7828C22.3573 23.9576 23.8358 21.1366 23.8358 17.9562C23.8358 14.7758 22.3293 11.9548 20.014 10.1295C21.7155 8.802 23.8637 8 26.207 8C31.7585 8 36.2498 12.4803 36.2498 17.9562Z"
                            fill="#F79E1B" />
                    </svg>
                </div>
                <div>
                    <p class="font-semibold text-xs md:text-lg">**** **** **** {{ payment.card.last4 }}</p>
                    <p class="text-[#4D4D4D] text-xs md:text-base">{{ payment.billingDetails.name }}</p>
                </div>
            </div>
            <div>
                <button class="btn bg-transparent border text-error  border-[#E0E0E0]">Delete</button>
            </div>
        </div>
        <div class=" py-4 md:hidden flex ">
            <button @click="opeModal" class="btn w-full bg-primary px-6 py-4 text-base-black">Add Credit Card</button>
        </div>
        <ModalCrediCardVue v-if="storeModal?.isActive" />
    </div>
</template>

<script>
import { ref, onMounted, watch, computed } from "vue";
import { ModalCrediCard } from '@/stores/modalCrediCard';
import ModalCrediCardVue from "../../../../components/Modals/ModalAddPaymet/ModalCrediCard.vue";
import { useAuthStore } from "@/stores/auth";
import { usePayments } from "@/stores/payments";
export default {
    props: {
        needReview: {
            type: Array
        },
        dataUser: {
            type: Object
        }

    },
    components: {
        ModalCrediCardVue
    },
    setup(props) {
        const storeModal = ModalCrediCard()
        const dataUser = ref(props.dataUser)
        const controllerPayment = usePayments()
        const storeAuth = useAuthStore()
        const loading = ref(false)
        const opeModal = () => {
            storeModal.openModal({ isActive: true })

        }
        const addpayment = async () => {
            loading.value = true
            try {
                let res = await controllerPayment.addCard()
                console.log('res', res)
                if (res.data) {
                    window.location.href = res.data.url
                }

            } catch (error) {
                loading.value = false
                console.log('error', error)

            } finally {
                loading.value = false
            }
        }
        onMounted(() => {
            console.log('PEROOOTAAAAAAAA', storeAuth.userData)
        })
        return {
            storeModal,
            opeModal,
            loading,
            storeAuth,
            addpayment
        };
    },
};
</script>